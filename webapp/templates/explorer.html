{% extends "layout.html" %}
{% block head %}
 {{ super() }}
 <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.11.0/d3.js"></script>
 <!-- minified at https://cdnjs.cloudflare.com/ajax/libs/d3/4.11.0/d3.min.js -->
 <style>
 .link {
 	fill: none;
 	stroke: #555;
 	stroke-width: 1.5px;
 	stroke-opacity: 0.7;
 }
</style>
{% endblock %}
{% block title %}Explore!{% endblock %}
{% block end_of_body %}
<script type="text/javascript">
var width = 600; 
var height = 500; 
var cluster = d3.cluster()    
   .size([height, width-200]); 
var svg = d3.select("#main-block").append("svg")    
   .attr("width",width)    
   .attr("height",height)    
   .append("g")    
   .attr("transform","translate(100,0)"); 
d3.json("{{ url_for('get_result', result_id=result_id) }}", function(error, root){
   console.log("Got result from server")
   console.log(root);
   var hierarchy = d3.hierarchy(root);
   cluster(hierarchy);
   var nodes = hierarchy.descendants();
   var links = hierarchy.links();
   var link = svg.selectAll(".link")       
      .data(links)       
      .enter()
         .append("path")       
         .attr("class","link")       
         .attr("d", d3.linkHorizontal()
				          .x(function(d) { return d.y; })
				          .y(function(d) { return d.x; }));     
   var node = svg.selectAll(".node")       
      .data(nodes)       
      .enter()
         .append("g")       
         .attr("class","node")       
         .attr("transform", function(d) { return "translate(" + d.y + "," + d.x + ")"; });    
   node.append("circle")       
      .attr("r", 4.5);    
   node.append("text")       
      .attr("dx", function(d) { return d.data.children ? -8 : 8; })       
      .attr("dy", 3)       
      .style("text-anchor", function(d) { return d.data.children ? "end" : "start"; })      
      .text( function(d){ console.log(d); return d.data.name;}); 
}); 

</script>
{% endblock %}